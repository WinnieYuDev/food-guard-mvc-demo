<%- include('partials/header') %>

<main class="max-w-4xl mx-auto py-8 px-4">
    <div class="mb-6">
        <a href="/recalls" class="inline-flex items-center text-usda-blue hover:text-usda-darkblue font-medium transition-colors">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
            </svg>
            Back to Recalls
        </a>
    </div>

    <div class="bg-white rounded-lg shadow-md p-6 mb-6 border border-gray-200">
        <div class="flex items-center justify-between mb-4">
            <div class="flex-1 pr-4">
                <h1 class="text-2xl font-bold text-gray-900 leading-tight"><%= recall.title %></h1>
                <div class="text-sm text-gray-600 mt-1">
                    <span class="font-medium"><%= recall.agency || 'Agency' %></span>
                    &middot;
                    <span><%= recall.recallDate ? new Date(recall.recallDate).toLocaleDateString() : 'Date unknown' %></span>
                    &middot;
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium <%= recall.riskLevel === 'high' ? 'bg-red-100 text-red-800' : recall.riskLevel === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-green-100 text-green-800' %>"><%= recall.riskLevel ? recall.riskLevel.charAt(0).toUpperCase() + recall.riskLevel.slice(1) : 'Unknown' %></span>
                </div>
            </div>
            <div class="text-right flex-shrink-0">
                <% if (recall.articleLink) { %>
                    <a href="<%= recall.articleLink %>" target="_blank" rel="noopener noreferrer" class="inline-flex items-center bg-usda-blue hover:bg-usda-darkblue text-white px-4 py-2 rounded-md font-medium">View Official Notice</a>
                <% } else { %>
                    <a href="/recalls" class="inline-flex items-center bg-gray-100 text-gray-800 px-4 py-2 rounded-md font-medium">No external link</a>
                <% } %>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-start mb-4">
            <div class="col-span-1 md:col-span-1 text-sm text-gray-700"><strong>Product:</strong> <span class="ml-1"><%= recall.product || 'N/A' %></span></div>
            <div class="col-span-1 md:col-span-1 text-sm text-gray-700"><strong>Brand:</strong> <span class="ml-1"><%= recall.brand || 'N/A' %></span></div>
            <div class="col-span-1 md:col-span-1 text-sm text-gray-700"><strong>Reason:</strong> <span class="ml-1"><%= recall.description || 'Not specified' %></span></div>
        </div>

        <% if (extraProviderInfo) { %>
            <div class="mt-6 border-t border-gray-200 pt-4">
                <div class="text-sm text-gray-700 bg-gray-50 p-3 rounded">
                    <div class="flex flex-wrap items-center gap-3 text-sm text-gray-700">
                        <div><strong>Company:</strong> <span class="ml-1"><%= recall.brand || 'N/A' %></span></div>
                        <div><strong>State:</strong> <span class="ml-1"><%= extraProviderInfo.state || 'Unknown' %></span></div>
                        <div><strong>Contact:</strong> <span class="ml-1"><%= extraProviderInfo.mediaName || 'N/A' %></span></div>
                        <% if (extraProviderInfo.mediaEmail) { %>
                            <div><strong>Email:</strong> <a href="mailto:<%= extraProviderInfo.mediaEmail %>" class="text-usda-blue ml-1"><%= extraProviderInfo.mediaEmail %></a></div>
                        <% } %>
                        <% if (extraProviderInfo.mediaPhone) { %>
                            <div><strong>Phone:</strong> <a href="tel:<%= extraProviderInfo.mediaPhone.replace(/[^0-9+]/g,'') %>" class="text-usda-blue ml-1"><%= extraProviderInfo.mediaPhone %></a></div>
                        <% } %>
                    </div>
                    <% if (extraProviderInfo.raw && !extraProviderInfo.mediaName && !extraProviderInfo.mediaPhone && !extraProviderInfo.mediaEmail) { %>
                        <details class="mt-2 text-xs text-gray-500"><summary>Raw provider data</summary><pre class="whitespace-pre-wrap"><%= JSON.stringify(extraProviderInfo.raw, null, 2) %></pre></details>
                    <% } %>
                </div>
            </div>
        <% } else if (relatedRecalls && relatedRecalls.length) { %>
            <div class="mt-6 border-t border-gray-200 pt-4">
                <h3 class="text-lg font-semibold mb-3">Related Active Recalls</h3>
                <ul class="space-y-2">
                    <% relatedRecalls.forEach(rr => { %>
                        <li>
                            <% if (rr.articleLink) { %>
                                <a href="<%= rr.articleLink %>" target="_blank" rel="noopener noreferrer" class="text-usda-blue font-medium"><%= rr.title %></a>
                            <% } else if (rr._id) { %>
                                <a href="/recalls/<%= rr._id %>" class="text-usda-blue font-medium"><%= rr.title %></a>
                            <% } else { %>
                                <span class="font-medium"><%= rr.title %></span>
                            <% } %>
                            <div class="text-xs text-gray-500"><%= rr.recallDate ? new Date(rr.recallDate).toLocaleDateString() : '' %></div>
                        </li>
                    <% }); %>
                </ul>
            </div>
        <% } %>

    </div>
</main>

<%- include('partials/footer') %>
